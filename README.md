# Kerkerker - å½±è§†èµ„æºèšåˆå¹³å°

ä¸€ä¸ªåŸºäº Next.js çš„å½±è§†èµ„æºèšåˆå¹³å°ï¼Œæ”¯æŒä» Dailymotion è·å–èµ„æºï¼Œå¹¶æä¾›ç¾è§‚çš„æ’­æ”¾ç•Œé¢å’Œåå°ç®¡ç†åŠŸèƒ½ã€‚

## ğŸ“‹ ç›®å½•

- [åŠŸèƒ½ç‰¹æ€§](#-åŠŸèƒ½ç‰¹æ€§)
- [ç¯å¢ƒé…ç½®](#-ç¯å¢ƒé…ç½®)
- [è±†ç“£ API ä»£ç†](#-è±†ç“£-api-ä»£ç†)
- [Docker éƒ¨ç½²](#-docker-éƒ¨ç½²)
  - [æ„å»ºé•œåƒ](#1-æ„å»ºé•œåƒ)
  - [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²](#2-ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²)
- [æœ¬åœ°å¼€å‘](#-æœ¬åœ°å¼€å‘)

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ¬ èšåˆ Dailymotion è§†é¢‘èµ„æº
- ğŸ“ è±†ç“£ç”µå½±ä¿¡æ¯è‡ªåŠ¨åŒ¹é…
- ğŸ“± å“åº”å¼è®¾è®¡ï¼Œå®Œç¾æ”¯æŒç§»åŠ¨ç«¯
- ğŸ¨ ç°ä»£åŒ– UI/UXï¼Œç±»ä¼¼ TikTok çš„çŸ­å‰§åˆ·è§†é¢‘ä½“éªŒ
- ğŸ” åå°ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒæºç®¡ç†å’Œé…ç½®

## ğŸ”§ ç¯å¢ƒé…ç½®

é¡¹ç›®ä¾èµ–ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼Œè¯·åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼ˆå¼€å‘ç¯å¢ƒï¼‰æˆ–åœ¨éƒ¨ç½²æ—¶è®¾ç½®ç¯å¢ƒå˜é‡ã€‚

### æ ¸å¿ƒé…ç½®

| å˜é‡å | è¯´æ˜ | å¿…å¡« | é»˜è®¤å€¼ | ç¤ºä¾‹ |
|--------|------|------|--------|------|
| `MONGODB_URI` | MongoDB æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸² | **æ˜¯** | - | `mongodb://user:pass@localhost:27017/kerkerker` |
| `MONGODB_DB_NAME` | æ•°æ®åº“åç§° | å¦ | `kerkerker` | `kerkerker_prod` |
| `ADMIN_PASSWORD` | åå°ç®¡ç†å¯†ç  | å¦ | `admin123` | `MySecurePass123!` |
| `NODE_ENV` | ç¯å¢ƒæ¨¡å¼ | å¦ | `development` | `production` |

### è±†ç“£ API ä»£ç†é…ç½®

ç”±äºè±†ç“£ API æœ‰ä¸¥æ ¼çš„ IP è®¿é—®é™åˆ¶ï¼Œå»ºè®®é…ç½® Cloudflare Workers ä»£ç†ã€‚

| å˜é‡å | è¯´æ˜ | å¿…å¡« | é»˜è®¤å€¼ | ç¤ºä¾‹ |
|--------|------|------|--------|------|
| `DOUBAN_API_PROXY` | è±†ç“£ä»£ç†åœ°å€ï¼Œæ”¯æŒå¤šä¸ªï¼ˆé€—å·åˆ†éš”ï¼‰ | å¦ | - | `https://proxy1.workers.dev,https://proxy2.workers.dev` |
| `DOUBAN_PROXY_ACCOUNTS` | éƒ¨ç½²ä»£ç†ç”¨çš„ Cloudflare è´¦å·ä¿¡æ¯ | å¦ | - | `name:acc_id:token,name2:acc_id:token` |

---

## ğŸš€ è±†ç“£ API ä»£ç†

ä¸ºäº†è§£å†³è±†ç“£ API çš„è®¿é—®é™åˆ¶ï¼Œæœ¬é¡¹ç›®æä¾›äº†é…å¥—çš„ Cloudflare Workers ä»£ç†è„šæœ¬ã€‚

### æ–¹å¼ä¸€ï¼šè‡ªåŠ¨éƒ¨ç½²ï¼ˆæ¨èï¼‰

æˆ‘ä»¬æä¾›äº†è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œå¯ä»¥å°†ä»£ç†éƒ¨ç½²åˆ°ä½ çš„ Cloudflare è´¦å·ï¼ˆæ”¯æŒå¤šè´¦å·éƒ¨ç½²ä»¥å®ç°è´Ÿè½½å‡è¡¡ï¼‰ã€‚

1. **è·å– Cloudflare ä¿¡æ¯**ï¼š
   - ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com/)
   - è·å– **Account ID** (åœ¨ URL æˆ– Workers é¡µé¢å³ä¾§)
   - è·å– **API Token** (My Profile -> API Tokens -> Create Token -> é€‰æ‹© "Edit Cloudflare Workers" æ¨¡æ¿)

2. **é…ç½®ç¯å¢ƒå˜é‡**ï¼š
   åœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ  `DOUBAN_PROXY_ACCOUNTS`ï¼Œæ ¼å¼ä¸º `è´¦å·å:Account_ID:API_Token`ï¼Œå¤šä¸ªè´¦å·ç”¨é€—å·åˆ†éš”ï¼š

   ```bash
   DOUBAN_PROXY_ACCOUNTS="account1:ID1:TOKEN1,account2:ID2:TOKEN2"
   ```

3. **è¿è¡Œéƒ¨ç½²**ï¼š

   ```bash
   ./scripts/deploy-douban-proxy.sh
   ```

4. **é…ç½®ç¯å¢ƒå˜é‡**ï¼š
   éƒ¨ç½²æˆåŠŸåï¼Œè„šæœ¬ä¼šè¾“å‡º Worker URLã€‚å°†è¿™äº› URL æ·»åŠ åˆ° `.env` æ–‡ä»¶çš„ `DOUBAN_API_PROXY` ä¸­ã€‚

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²

1. ç™»å½• Cloudflare Dashboardã€‚
2. è¿›å…¥ **Workers & Pages** -> **Create Application** -> **Create Worker**ã€‚
3. å¤åˆ¶ `docs/cloudflare-douban-proxy.js` çš„å†…å®¹åˆ°ç¼–è¾‘å™¨ä¸­ã€‚
4. ä¿å­˜å¹¶éƒ¨ç½²ã€‚
5. å°†ç”Ÿæˆçš„ Worker URL é…ç½®åˆ° `DOUBAN_API_PROXY`ã€‚

---

## ğŸ³ Docker éƒ¨ç½²

æœ¬é¡¹ç›®æ”¯æŒ Docker å®¹å™¨åŒ–éƒ¨ç½²ï¼Œæä¾›äº†æ„å»ºè„šæœ¬å’Œç¼–æ’æ–‡ä»¶ã€‚

### 1. æ„å»ºé•œåƒ

æ„å»ºè„šæœ¬ä¼šè‡ªåŠ¨æ„å»ºå¤šæ¶æ„é•œåƒï¼ˆamd64/arm64ï¼‰å¹¶æ¨é€åˆ° Docker Hubã€‚

**å‰ææ¡ä»¶**ï¼š

- å·²å®‰è£… Docker å’Œ Docker Buildx
- å·²ç™»å½• Docker Hub (`docker login`)

**æ“ä½œæ­¥éª¤**ï¼š

1. è¿è¡Œæ„å»ºè„šæœ¬ï¼š

   ```bash
   ./scripts/deploy-server.sh
   ```

   è¯¥è„šæœ¬ä¼šï¼š
   - æ£€æŸ¥ Docker Hub ç™»å½•çŠ¶æ€
   - åˆ›å»ºå¤šæ¶æ„æ„å»ºå™¨
   - æ„å»ºé•œåƒå¹¶æ¨é€åˆ° `kerkerker-app`
   - æ›´æ–°æœ¬åœ°éƒ¨ç½²

### 2. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

å¦‚æœä½ åªéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œåº”ç”¨ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ `docker-compose.server.yml`ã€‚

1. **å‡†å¤‡æ–‡ä»¶**ï¼š
   å°†ä»¥ä¸‹æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ç›®å½•ï¼š
   - `docker-compose.server.yml`
   - `.env` (åŒ…å«ç”Ÿäº§ç¯å¢ƒé…ç½®)

2. **ä¿®æ”¹é…ç½®**ï¼š
   ç¡®ä¿ `.env` æ–‡ä»¶ä¸­å·²è®¾ç½® `MONGODB_URI` å’Œå…¶ä»–å¿…è¦å˜é‡ã€‚

3. **å¯åŠ¨æœåŠ¡**ï¼š

   ```bash
   # ä½¿ç”¨ server é…ç½®å¯åŠ¨
   docker-compose -f docker-compose.server.yml up -d
   ```

4. **æŸ¥çœ‹æ—¥å¿—**ï¼š

   ```bash
   docker-compose -f docker-compose.server.yml logs -f
   ```

5. **æ›´æ–°æœåŠ¡**ï¼š
   å¦‚æœè¦æ›´æ–°é•œåƒï¼Œå¯ä»¥è¿è¡Œï¼š

   ```bash
   docker-compose -f docker-compose.server.yml pull
   docker-compose -f docker-compose.server.yml up -d
   ```

---

## ğŸ’» æœ¬åœ°å¼€å‘

1. **å®‰è£…ä¾èµ–**ï¼š

   ```bash
   npm install
   ```

2. **å¯åŠ¨ MongoDB**ï¼š
   å¯ä»¥ä½¿ç”¨ Docker å¯åŠ¨æœ¬åœ° MongoDBï¼š

   ```bash
   docker-compose up -d mongo
   ```

3. **è¿è¡Œå¼€å‘æœåŠ¡å™¨**ï¼š

   ```bash
   npm run dev
   ```

4. **è®¿é—®åº”ç”¨**ï¼š
   æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:3000`

## ğŸ“œ License

MIT
